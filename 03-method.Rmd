# Preparación y análisis

## Cargue de datos

Importamos la información de tráfico de una Estación base del municipio de Cundinamarca, esta información ya viene anonimizada en sus nombres para seguridad de la empresa

Realizamos el cague de los datos

```{r}
data_sitio <- read.csv("data_sitio.csv", sep = ";")
```

### Formato de fechas

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(lubridate)
library(zoo)
library(TTR) # libreria promedios móviles
library(forecast) #  libreria estacionalidad y rezagos
library(tseries)

```


Para el manejo de datos en la columna "M_FECHA_DIA" damos formato con  "as.Date" lo ordenamos

```{r}
data_sitio$M_FECHA_DIA <- as.Date(data_sitio$M_FECHA_DIA)
data_sitio <- data_sitio[order(data_sitio$M_FECHA_DIA), ]
```

Buscamos el mínimo día y la cantidad de días
```{r}

fecha_inicio <- min(data_sitio$M_FECHA_DIA)
n_dias <- as.numeric(max(data_sitio$M_FECHA_DIA) - fecha_inicio) + 1
fecha_max <- max(data_sitio$M_FECHA_DIA)
fecha_inicio
fecha_max
```

Verificamos el dia mínimo y el máximo
```{r}
fecha_inicio
fecha_max
```


Verificamos si la serie no tiene datos faltantes entre dias
```{r}
fechas_completas <- seq(fecha_inicio, by = "day", length.out = n_dias)
if(length(fechas_completas) != nrow(data_sitio)) {
  warning("Hay fechas faltantes en los datos. Deberás interpolar o manejar los valores faltantes antes de continuar.")
}
```


### Selección de campos

Seleccionamos  las columnas de interés  de fecha ("M_FECHA_DIA") y tráfico en LTE () "PAYLOAD_4G")

```{r}

selected_columns <- data_sitio[, c("M_FECHA_DIA", "PAYLOAD_4G")]
head(selected_columns)
```





Creamos la serie de tiempo con la función  "ts" donde le indicamos la fecha de inicio con una frecuencia diaria
```{r}

serie_tiempo <- ts(
    data_sitio$PAYLOAD_4G, 
    start=c(as.numeric(format(fecha_inicio, "%Y")), as.numeric(format(fecha_inicio, "%j"))),
    frequency=365
    )

```

Verificamos el tipo de datos de la serie de tiempo 
```{r}
class(serie_tiempo)
```


Validación de fecha mínima y máxima de la serie

```{r}
start_time <- start(serie_tiempo)
end_time <- end(serie_tiempo)
frequency <- frequency(serie_tiempo)
min_date <- as.Date(paste(start_time[1], start_time[2], sep="-"), "%Y-%j")
max_date <- as.Date(paste(end_time[1], (end_time[2]-1) / frequency * 365, sep="-"), "%Y-%j")

min_date
max_date

```

## Análisis Series de tiempo

### Análisis descriptivo

Al visualizar la serie de tiempo se puede ver la tendencia del tráfico con una pendiente positiva, al tener una población en constante crecimiento y con más demanda de datos móviles en redes LTE 
```{r}
plot(serie_tiempo)
```

Tráfico por Año
```{r}
seasonplot(serie_tiempo,col=rainbow(4),year.labels = TRUE)
```


 
### Análisis de Promedio Móvil

Con la función "rollmean" suavizamos la serie usando una ventana de 7 días, en la gráfica 
podemos observar como el promedio Móvil representado por la línea roja suavizo los outlier que salía en la serie original representado con negro


```{r}
promedio_movil <- rollmean(serie_tiempo, 7, fill = NA)

plot(serie_tiempo, main="Serie Temporal con Promedio Móvil", xlab="Fecha", ylab="PAYLOAD_4G")
lines(promedio_movil, col="red")
legend("topright", legend=c("Serie Original", "Promedio Móvil"), col=c("black", "red"), lty=1)

```

### Análisis de Rezagos

En este análisis podemos observar como los valores pasados de una serie afectan sus valores futuros
En la imagen podemos observar como todas las barras superan el umbral de líneas azules (+/-)1.96, lo que demuestra una alta autocorrelación en todos los rezagos. Esta autocorrelación demuestra que la serie no es aleatoria y puede ser una señal de estacionalidad o de tendencia


```{r}
acf(serie_tiempo)

```

### Análisis de Estacionalidad

Dentro la imagen podemos observar lo siguiente

1. **Observed:**: Nos muestra la serie original , es decir la serie sin modificaciones.
    
2. **Tred:** En la tendencia nos muestra la tendencia eliminando el ruido y estacionalidad sin embargo se observan los  picos de tráfico al final.
  
3. **Seasonal:**: En la Estacionalidad podemos observar un patrón claro y repetitivo , lo cual indica  que existe estacionalidad en los datos del tráfico en esta de serie de tiempo.

3. **Random**: Este gráfico muestra residuales o fluctuaciones que nos se pueden explicar , ya que puede ser atípicos o ruido, para estos casos particulares en tráfico hay que hacer investigaciones de las causas de estas anomalias.


```{r}
descomposicion <- decompose(serie_tiempo)

plot(descomposicion)


write.csv(serie_tiempo, "serie_tiempo.csv", row.names = FALSE)
```





